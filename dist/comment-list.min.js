/*! comment-list 25-07-2017 */
"use strict";!function(a){function b(a,b,c){this.list=a,this.element=b,this.config=Object.assign({standardImage:"images/test-user.png",noUserImage:"images/no-name-user.png",inputPlaceHolder:"Join the discussion",replyPlaceHolder:"Enter reply",userLinkFormatter:function(a){return a}},c)}function c(a,b,c,d){var e=document.createElement(a||"div");if(b){b.split(" ").forEach(function(a){e.classList.add(a)})}return e.innerHTML=c||"",d&&d.length&&d.forEach(function(a){e.setAttribute(a.key,a.value)}),e}function d(a){var b=new c("div"),d=new e(a.noUserImage,"user-image"),f=new c("input","input-section","",[{key:"placeholder",value:a.inputPlaceHolder}]),g=new c("div","clear");return b.appendChild(d),b.appendChild(f),b.appendChild(g),b}function e(a,b,d){return new c("img",b,"",[{key:"src",value:a||d.standardImage}])}function f(a,b,d){var e=new c("div","reply-container hide"),f=new c("input","","",[{key:"type",value:"text"},{key:"placeholder",value:a.replyPlaceHolder}]),g=function(c){var e=c.target.value;"function"==typeof a.replyCommentHandler?a.replyCommentHandler({parentId:b.id,content:e}).then(function(a){b.children.unshift(a),d()}):console.log("revertDislikeHandler not registered")};return e.appendChild(f),f.addEventListener("keypress",function(a){13==a.which&&g(a)}),e}function g(a,b){function d(){k.innerHTML="";var b=new c("span","like"===a.yourLike?"liked":"like",(a.likes||0)+" - "+("like"===a.yourLike?"Liked":"Like")),d=new c("span","dislike"===a.yourLike?"disliked":"dislike",(a.dislikes||0)+" - "+("dislike"===a.yourLike?"Disliked":"Dislike")),e=new c("span","reply","Reply"),f=new c("span","share","Share");k.appendChild(b),k.appendChild(d),k.appendChild(e),k.appendChild(f)}function e(){b.likeHandler?b.likeHandler(a).then(function(b){a=Object.assign(a,b),d()}):console.log("likeHandler not registered")}function f(){b.dislikeHandler?b.dislikeHandler(a).then(function(b){a=Object.assign(a,b),d()}):console.log("dislikeHandler not registered")}function g(){b.revertLikeHandler?b.revertLikeHandler(a).then(function(b){a=Object.assign(a,b),d()}):console.log("revertLikeHandler not registered")}function h(){b.revertDislikeHandler?b.revertDislikeHandler(a).then(function(b){a=Object.assign(a,b),d()}):console.log("revertDislikeHandler not registered")}function i(a){commentListUtils.findAncestor(a.target,"comment-block").querySelector(".reply-container").classList.remove("hide")}function j(){k.addEventListener("click",function(b){switch(b.target.className){case"share":var c=new CustomEvent("share-post",{detail:a});document.dispatchEvent(c);break;case"like":e();break;case"dislike":f();break;case"liked":g();break;case"disliked":h();break;case"reply":i(b)}})}var k=new c("div","like-dislike-container");return j(),d(),k}function h(a,b){function d(){r.innerHTML="",a.forEach(function(a){if(m=new c("div","clear"),l=new g(a,b),k=new e(a.userImageUrl,"user-image",b),i=new c("div","comment-block"),j=new c("div","children-comments"),n=new c("span","user-name",b.userLinkFormatter(a.userName)),o=new c("span","comment-time",commentListUtils.timeSince(a.time)),p=new c("div","content",a.content),q=new f(b,a,d),i.appendChild(k),i.appendChild(n),i.appendChild(o),i.appendChild(p),i.appendChild(l),i.appendChild(q),i.appendChild(m),a.children&&a.children.length){var s=new h(a.children,b);j.appendChild(s)}i.appendChild(j),r.appendChild(i)})}var i,j,k,l,m,n,o,p,q,r=new c("div");return d(),r}function i(a,b){a.querySelector(".input-section").addEventListener("keypress",function(a){13==a.which&&"function"==typeof b&&b(a)})}b.prototype.destroy=function(){this.element.innerHTML=""},b.prototype.render=function(){var a=this,b=this.config,e=new h(this.list,b),f=new d(b),g=new c("div","comments-widget");this.element.appendChild(g);var j=new c("div","input-container");j.append(f),g.appendChild(j),j=new c("div","comment-list-container"),j.appendChild(e),g.appendChild(j),i(g,function(c){var d=c.target.value;(d=d.trim())&&("function"==typeof b.submitAPIHandler?b.submitAPIHandler({content:d}).then(function(b){a.list.unshift(b),a.destroy(),a.render()}):console.log("Don't know what to do with this comment"))})},a.commentList=function(a,c,d){return new b(a,c,d)}}(window),function(a){function b(a){var b=Math.floor((new Date-a)/1e3),c=Math.floor(b/31536e3);if(c>1)return c+" years ago";if((c=Math.floor(b/2592e3))>1)return c+" months ago";if((c=Math.floor(b/86400))>1)return c+" days ago";if((c=Math.floor(b/3600))>1)return c+" hours ago";if((c=Math.floor(b/60))>1)return c+" minutes ago";var d=Math.floor(b);return d<5?"Just now":d<15?"a few seconds ago":d+" seconds ago"}function c(a,b){for(;(a=a.parentElement)&&!a.classList.contains(b););return a}a.commentListUtils={timeSince:b,findAncestor:c}}(window);