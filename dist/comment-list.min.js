/*! comment-list 25-07-2017 */
"use strict";!function(a){function b(a,b,c){this.list=a,this.element=b,this.config=Object.assign({standardImage:"images/test-user.png",noUserImage:"images/no-name-user.png",inputPlaceHolder:"Join the discussion",replyPlaceHolder:"Enter reply",maxLevelDown:2,userLinkFormatter:function(a){return a}},c)}function c(a,b,c,d){var e=document.createElement(a||"div");if(b){b.split(" ").forEach(function(a){e.classList.add(a)})}return e.innerHTML=c||"",d&&d.length&&d.forEach(function(a){e.setAttribute(a.key,a.value)}),e}function d(a){var b=new c("div"),d=new e(a.noUserImage,"user-image"),f=new c("input","input-section","",[{key:"placeholder",value:a.inputPlaceHolder}]),g=new c("div","clear");return b.appendChild(d),b.appendChild(f),b.appendChild(g),b}function e(a,b,d){return new c("img",b,"",[{key:"src",value:a||d.standardImage}])}function f(a,b,d){var e=new c("div","reply-container hide"),f=new c("input","","",[{key:"type",value:"text"},{key:"placeholder",value:a.replyPlaceHolder}]),g=function(c){var e=c.target.value;"function"==typeof a.replyCommentHandler?a.replyCommentHandler({parentId:b.id,content:e}).then(function(a){b.children.unshift(a),d()}):console.log("revertDislikeHandler not registered")};return e.appendChild(f),f.addEventListener("keypress",function(a){13==a.which&&g(a)}),e}function g(a,b,d){function e(){l.innerHTML="";var e=new c("span","like"===a.yourLike?"liked":"like",(a.likes||0)+" - "+("like"===a.yourLike?"Liked":"Like")),f=new c("span","dislike"===a.yourLike?"disliked":"dislike",(a.dislikes||0)+" - "+("dislike"===a.yourLike?"Disliked":"Dislike")),g=new c("span","reply","Reply"),h=new c("span","share","Share");l.appendChild(e),l.appendChild(f),b.maxLevelDown>=d&&l.appendChild(g),l.appendChild(h)}function f(){b.likeHandler?b.likeHandler(a).then(function(b){a=Object.assign(a,b),e()}):console.log("likeHandler not registered")}function g(){b.dislikeHandler?b.dislikeHandler(a).then(function(b){a=Object.assign(a,b),e()}):console.log("dislikeHandler not registered")}function h(){b.revertLikeHandler?b.revertLikeHandler(a).then(function(b){a=Object.assign(a,b),e()}):console.log("revertLikeHandler not registered")}function i(){b.revertDislikeHandler?b.revertDislikeHandler(a).then(function(b){a=Object.assign(a,b),e()}):console.log("revertDislikeHandler not registered")}function j(a){commentListUtils.findAncestor(a.target,"comment-block").querySelector(".reply-container").classList.remove("hide")}function k(){l.addEventListener("click",function(b){switch(b.target.className){case"share":var c=new CustomEvent("share-post",{detail:a});document.dispatchEvent(c);break;case"like":f();break;case"dislike":g();break;case"liked":h();break;case"disliked":i();break;case"reply":j(b)}})}var l=new c("div","like-dislike-container");return k(),e(),l}function h(a,b,d){function i(){s.innerHTML="",a.forEach(function(a){if(n=new c("div","clear"),m=new g(a,b,d),l=new e(a.userImageUrl,"user-image",b),j=new c("div","comment-block"),k=new c("div","children-comments"),o=new c("span","user-name",b.userLinkFormatter(a.userName)),p=new c("span","comment-time",commentListUtils.timeSince(a.time)),q=new c("div","content",a.content),r=new f(b,a,i),j.appendChild(l),j.appendChild(o),j.appendChild(p),j.appendChild(q),j.appendChild(m),b.maxLevelDown>=d&&j.appendChild(r),j.appendChild(n),a.children&&a.children.length){var t=new h(a.children,b,d+1);k.appendChild(t)}j.appendChild(k),s.appendChild(j)})}var j,k,l,m,n,o,p,q,r,s=new c("div");return i(),s}function i(a,b){a.querySelector(".input-section").addEventListener("keypress",function(a){13==a.which&&"function"==typeof b&&b(a)})}b.prototype.destroy=function(){this.element.innerHTML=""},b.prototype.render=function(){var a=this,b=this.config,e=new h(this.list,b,1),f=new d(b),g=new c("div","comments-widget");this.element.appendChild(g);var j=new c("div","input-container");j.append(f),g.appendChild(j),j=new c("div","comment-list-container"),j.appendChild(e),g.appendChild(j),i(g,function(c){var d=c.target.value;(d=d.trim())&&("function"==typeof b.submitAPIHandler?b.submitAPIHandler({content:d}).then(function(b){a.list.unshift(b),a.destroy(),a.render()}):console.log("Don't know what to do with this comment"))})},a.commentList=function(a,c,d){return new b(a,c,d)}}(window),function(a){function b(a){var b=Math.floor((new Date-a)/1e3),c=Math.floor(b/31536e3);if(c>1)return c+" years ago";if((c=Math.floor(b/2592e3))>1)return c+" months ago";if((c=Math.floor(b/86400))>1)return c+" days ago";if((c=Math.floor(b/3600))>1)return c+" hours ago";if((c=Math.floor(b/60))>1)return c+" minutes ago";var d=Math.floor(b);return d<5?"Just now":d<15?"a few seconds ago":d+" seconds ago"}function c(a,b){for(;(a=a.parentElement)&&!a.classList.contains(b););return a}a.commentListUtils={timeSince:b,findAncestor:c}}(window);